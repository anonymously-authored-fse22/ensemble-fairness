{"cells":[{"metadata":{},"cell_type":"markdown","source":"# Predicting German Credit Risk (logit regression&xgboost)\n### Welcome to the kernel of a starter in kaggle!    \n### If you like it, please **vote up**!"},{"metadata":{},"cell_type":"markdown","source":"## content\n1. statistical discription\n2. data exploring\n3. data processing\n4. modeling\n"},{"metadata":{},"cell_type":"markdown","source":"### 1. statistical discription\n#### 1.1 data loading     \n##### 1) Choose data with y-value from data set \"german_credit_data_with_risk\".\n##### 2) Then show the first six row of the table, remove the first column, which is the id of sample."},{"metadata":{"trusted":true},"cell_type":"code","source":"####statistical discription####\n#1.1data loading\ndat = read.csv(\"../input/german-credit-data-with-risk/german_credit_data.csv\")\n\nhead(dat)            #watch first 6 row of the data\ndat = dat[,-1]       #remove the first column","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### 1.2 know more about the data\n\n##### 1) Use summary to know that there are four numerical variables, while others are all categorical variables.\n##### 2) 'checking.account' and 'saving.account' have missing values which take up 39.4% and 18.3%.\n##### 3) Noticing that y-value is unbalanced, so we msy need group sampling. \n##### 4) Next devide these samples by y-value.\n"},{"metadata":{"_cell_guid":"79c7e3d0-c299-4dcb-8224-4455121ee9b0","_uuid":"d629ff2d2480ee46fbb7e2d37f6b5fab8052498a","trusted":true},"cell_type":"code","source":"#know more about the data\n#summary of the data\nsummary(dat)\n\n#check the rate of missing values\nmiss = function(x){sum(is.na(x))/length(x)*100}\napply(dat,2,miss)\n\n#pay attention to the unbalanced y-value\nplot(dat[,10])\n\n#devide them by y-value\ngood = dat[which(dat[,10]==\"good\"),]\nbad = dat[which(dat[,10]==\"bad\"),]","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"### 2.data exploring\n#### 2.1 age & housing\n##### Draw histogram of age and housing respectively in t\"y-value good\", \"y-value bad\", \"all\"."},{"metadata":{"trusted":true},"cell_type":"code","source":"####data exploring####\n# 2.1 age & housing\n#age\n#win.graph(width = 8,height = 2.5)\npar(mfrow=c(1,3))\nhist(good[,1],xlab=\"age\",ylab=\"\",main=\"\",ylim=c(0,160))\nhist(bad[,1],xlab=\"age\",ylab=\"\",main=\"\",ylim=c(0,160))\nhist(dat[,1],xlab=\"age\",ylab=\"\",main=\"\")\n\n#housing\nplot(good[,4],xlab=\"housing\",ylab=\"\",main=\"\",ylim=c(0,500))\nplot(bad[,4],xlab=\"housing\",ylab=\"\",main=\"\",ylim=c(0,500))\nplot(dat[,4],xlab=\"housing\",ylab=\"\",main=\"\")","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"##### 1) The distribution diagrams of \"good\" and \"all\" groups are identical.\n##### 2) Variable \"age\" has right-skewed distribution.\n##### 3) People who own a house are more likely in \"good credit\" group. \n\n#### 2.2 credit amount & duration\n##### Draw scatter plot of them in \"y-value good\"(circle shape), \"y-value bad\"(cross shape)."},{"metadata":{"trusted":true},"cell_type":"code","source":"#2.2 credit amount&duration\nplot(y=good[,7],x=good[,8],pch=1,\n     xlab=\"duration\",ylab=\"credit amount\",main=\"\")\npoints(y=bad[,7],x=bad[,8],pch=3,\n     xlab=\"duration\",ylab=\"credit amount\",main=\"\")","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"##### 1) In general, the number of short term loan is more than that of mid&long term loan, however the amount of the latter is more dispersed.\n##### 2) The defaults usually appears at a greater amount loan when the duration remains unchanged. Noticed that there is a gap between the top cross shape(s) and the following shapes in a column, it is clear that the shorter the duration, the greater the gap.\n### 3. data processing   \n##### Handle categorical variables: sex, housing, saving, checking, purpose and risk.\n##### Then make a correlation plot."},{"metadata":{"trusted":true},"cell_type":"code","source":"####data processing####\n#handle categorical variables\nlibrary(nnet)\nsex = class.ind(dat[,2]) \nhousing = class.ind(dat[,4]) \nsaving = class.ind(dat[,5])\ncolnames(saving) = c(\"s_little\",\"s_moderate\",\"s_quite rich\",\"s_rich\")\nchecking = class.ind(dat[,6]) \ncolnames(checking) = c(\"c_little\",\"c_moderate\",\"c_rich\")\npurpose = class.ind(dat[,9]) \nrisk = class.ind(dat[,10])\n\n#correlation plot\ndatn = dat[,c(-2,-4,-5,-6,-9,-10)]\nnewdat = cbind(datn,sex,housing,saving,checking,purpose,risk)\nmycor = cor(newdat)\n\nlibrary(corrplot)\npar(mfrow = c(1,1))\ncorrplot(mycor,tl.col=\"black\",method=\"color\",shade.lwd = 0.1,tl.cex=0.8,order=\"hclust\")","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"##### From the plot above, it is clear that \"saving.account little\", \"checking.account little\", \"duration\", \"credit.amount\" have weak positive correlation to \"bad\".\n##### \"checking.account little\", \"duration\" have relatively strong positive correlation.\n### 4. modeling\n#### 4.1 split data by group sampling \n##### Choose 70% as sampling ratio."},{"metadata":{"trusted":true},"cell_type":"code","source":"#4.1 split data by group sampling\nnewdat = newdat[,-25]\nnewdat = as.matrix(newdat[order(newdat$good), ])\nsiz = c(300,700)\nn = round(0.7*siz)\n\nlibrary(sampling)\ntr = strata(newdat, stratanames='good', size=n, method=\"srswor\")\ntrain = newdat[tr$ID_unit,] \ntest = newdat[-tr$ID_unit,] \nxtr = train[,1:24]\nytr = train[,25] \nxte = test[,1:24]\nyte = test[,25]\n\n#write.table(train, file =\"train data.csv\", sep =\",\")\n#write.table(test, file =\"test data.csv\", sep =\",\")\n","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### 4.2 logistic regression\n##### Notice: the critical values are different in glm-fitted.values and predict results!"},{"metadata":{"trusted":true},"cell_type":"code","source":"#4.2 logistic regression\nglm = glm(good~.,data=as.data.frame(train),family=binomial(\"logit\"))\n\nlogit.step = step(glm, direction = c(\"both\"))\n\nglm1 = glm(good~s_little+c_little+c_moderate+Duration+female+own,\n           data=as.data.frame(train),family=binomial(\"logit\"))\n\n#computing classification rate in training set\npyltr = glm1$fitted.values\nyltr = rep(0,length(pyltr))\nfor(i in 1:length(pyltr)){\n  if(pyltr[i]<=0.5){yltr[i]=0}\n  else{yltr[i]=1}\n}\ntrain_result1 = table(yltr,ytr)\nrate1 = (train_result1[1,1]+train_result1[2,2])/sum(train_result1)\n\n#computing classification rate in testing set\ny_pred = predict(glm1, as.data.frame(xte))\ny_tran = rep(0,length(y_pred))\nfor(i in 1:length(y_pred)){\n  if(y_pred[i]<=0){y_tran[i]=0}\n  else{y_tran[i]=1}\n}\ntest_result1 = table(y_tran,yte)\nrate2 = (test_result1[1,1]+test_result1[2,2])/sum(test_result1)","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### 4.3 logistic regression"},{"metadata":{"trusted":true},"cell_type":"code","source":"####xgboost####\n\nlibrary(xgboost)\nxgb = xgboost(data = xtr, \n               label = ytr, \n               eta = 0.1,\n               max_depth = 5, \n               gamma = 0,\n               objective = \"binary:logistic\",\n               nrounds = 15, \n               subsample = 0.8,\n               colsample_bytree = 0.8,\n               seed = 1,\n               eval_metric = \"error\"\n)\n\n#computing classification rate in training set\ny_pred = predict(xgb, xtr)\ny_train = rep(0,length(y_pred))\nfor(i in 1:length(y_pred)){\n  if(y_pred[i]<=0.5){y_train[i]=0}\n  else{y_train[i]=1}\n}\ntest_result3 = table(y_train,ytr)\nrate3 = (test_result3[1,1]+test_result3[2,2])/sum(test_result3)\n\n#computing classification rate in testing set\ny_pred = predict(xgb, xte)\ny_test = rep(0,length(y_pred))\nfor(i in 1:length(y_pred)){\n  if(y_pred[i]<=0.5){y_test[i]=0}\n  else{y_test[i]=1}\n}\ntest_result4 = table(y_test,yte)\nrate4 = (test_result4[1,1]+test_result4[2,2])/sum(test_result4)\n","execution_count":null,"outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### 4.4 results "},{"metadata":{"trusted":true},"cell_type":"code","source":"paste(\"classification rate in training set via logit regression is\", round(rate1,2))\npaste(\"classification rate in testing set via logit regression is\", round(rate2,2))\npaste(\"classification rate in training set via xgboost is\", round(rate3,2))\npaste(\"classification rate in testing set via xgboost is\", round(rate4,2))","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}